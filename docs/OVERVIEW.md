# 概要（OVERVIEW）

## 目的

公開ウェブサイト上で、以下の体験を**最小の労力**で成立させる。

1. 訪問者がサイトを開くと、**1時間に1枚更新**されるサンプル作品が表示される
2. 訪問者が購入導線（Purchase / Generate）を押すと、**その瞬間の最新データ**から作品を生成し、プレビュー表示
3. 訪問者がOKすれば決済（Stripe Checkout）を行い、注文が確定する
4. 作品は**額装アート（framed print）**として配送される（Gelatoで自動発注）

このリポジトリは「アートのコンセプト」ではなく、**仕組み（パイプライン）**を先に動かすための土台。

---

## 現在の状態

| Phase | 内容 | 状態 |
|-------|------|------|
| 0-3 | MVP（サンプル生成、プレビュー、決済） | ✅ Done |
| 4 | 手動フルフィルメント | 🚧 Next |
| 5 | Gelato自動発注 | 📋 Planned |
| 6 | 実データ導入 | 📋 Planned |

---

## スコープ

### MVP（Phase 0-3）✅ 完了

- Cloudflare上での定期サンプル生成（Cron）
- 最新サンプルの表示（Pages）
- 購入クリックによるプレビュー生成（Workers）
- Stripe Checkout（テスト）とWebhook受信
- 注文状態の保存（D1）
- 生成物の保存と配信（R2→Workers経由）

### Phase 4（次のステップ）

- 管理画面で注文一覧を確認
- マスターファイルをダウンロード
- 手動でGelatoに発注（運用手順をdocs化）

### Phase 5（Gelato自動発注）

- 決済完了 → Gelato APIで自動発注
- 配送ステータスの自動更新
- 商品: 額装ポスター（木製フレーム、A3/A4）

### Phase 6（実データ導入）

- 睡眠/心拍のAPI連携
- Whisper文字起こし結果の取り込み

---

## ユーザーフロー

### 訪問者

1. `Pages` を訪問
2. 最新サンプルを閲覧（毎時更新）
3. 「購入」→ プレビュー生成
4. 「OK」→ Stripe Checkout
5. 決済完了 → Success page
6. 額装プリントが届く（Gelato経由）

### 制作者（あなた）

- Cron実行の成功/失敗をログで見る
- 受注が入ったら：
  - **Phase 4まで**: 手動でGelato発注
  - **Phase 5以降**: 自動発注される
- Gelato Dashboardで発送状況を確認

---

## 技術スタック

| レイヤー | 技術 |
|----------|------|
| フロントエンド | Cloudflare Pages |
| API | Cloudflare Workers |
| データベース | Cloudflare D1 |
| ストレージ | Cloudflare R2 |
| 決済 | Stripe |
| POD | **Gelato** |

### なぜGelato？

| 項目 | Gelato |
|------|--------|
| 日本語対応 | ✅ ダッシュボード・サポート |
| アート品質 | ✅ ジクレー印刷 |
| 日本発送 | ✅ 現地パートナー（2-5日） |
| グローバル | ✅ 32ヵ国140+パートナー |
| 価格 | ✅ 無料プランあり、最低注文なし |

---

## データの扱い（前提）

- データ取得は2系統：
  - **API取得**（睡眠、心拍などのサービスからサーバ経由）
  - **アップロード**（ローカル保存→R2にアップロード）
- MVPではまず `mock` データで動かす（仕組みの検証を優先）

---

## 用語

| 用語 | 説明 |
|------|------|
| **Sample** | 1時間ごとに自動生成される見せ玉 |
| **Snapshot** | 作品生成に使った「その瞬間のデータ」を凍結保存したもの（再現性） |
| **Preview** | 購入時に生成してユーザーに見せる作品 |
| **Print master** | 印刷に送る最終データ（将来PDF） |
| **Order** | 決済・発送状態を持つ注文レコード |
| **POD** | Print on Demand（受注生産印刷） |
| **Gelato** | PODサービスプロバイダー |
